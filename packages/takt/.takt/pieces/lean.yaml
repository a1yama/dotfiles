name: lean
description: 軽量開発ピース（plan → implement → レビュー1名 → 修正ループ → 完了）
piece_config:
  provider_options:
    codex:
      network_access: true
    opencode:
      network_access: true
max_movements: 8
initial_movement: plan
movements:
  - name: plan
    edit: false
    persona: planner
    knowledge: architecture
    allowed_tools:
      - Read
      - Glob
      - Grep
      - Bash
    rules:
      - condition: 要件が明確で実装可能
        next: implement
      - condition: ユーザーが質問をしている（実装タスクではない）
        next: COMPLETE
      - condition: 要件が不明確、情報不足
        next: ABORT
    instruction: plan
    output_contracts:
      report:
        - name: plan.md
          format: plan
  - name: implement
    edit: true
    model: opus
    persona: coder
    policy:
      - coding
      - testing
    allowed_tools:
      - Read
      - Glob
      - Grep
      - Edit
      - Write
      - Bash
    required_permission_mode: edit
    instruction: implement
    rules:
      - condition: 実装が完了した
        next: review
      - condition: 実装を進行できない
        next: ABORT
      - condition: ユーザーへの確認事項があるためユーザー入力が必要
        next: implement
        requires_user_input: true
        interactive_only: true
    output_contracts:
      report:
        - name: coder-scope.md
          format: coder-scope
  - name: review
    edit: false
    model: opus
    persona: supervisor
    policy: review
    allowed_tools:
      - Read
      - Glob
      - Grep
      - Bash
    pass_previous_response: false
    instruction: supervise
    rules:
      - condition: すべて問題なし
        next: COMPLETE
      - condition: 要求未達成、テスト失敗、ビルドエラー
        next: fix
    output_contracts:
      report:
        - name: summary.md
          format: summary
          use_judge: false
  - name: fix
    edit: true
    model: opus
    persona: coder
    policy:
      - coding
      - testing
    allowed_tools:
      - Read
      - Glob
      - Grep
      - Edit
      - Write
      - Bash
    required_permission_mode: edit
    pass_previous_response: false
    rules:
      - condition: 監督者の指摘に対する修正が完了した
        next: review
      - condition: 修正を進行できない
        next: ABORT
    instruction: fix-supervisor
